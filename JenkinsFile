@Library('jenkins-shared-library')_
pipeline {
    agent any
    tools {
        maven "Maven"   
    }   
  
    stages {
        stage('Compile-Build-Test ') {
            steps {
	    	slackNotify 'Building Started'
                build 'BUILD'
            }
        }
        stage('SonarQube Analysis'){
            steps{
               sonar 'SONAR'
            }
        }
	     stage('Nexus') {
    		 steps{
          		nexus 'NEXUS' 
       			}
		   }
		   
	stage ('Test Environment')
	{
		steps{
			test-env 'TESTING'
		}
	}
	stage ('Performance Environment')
	{
		steps{
			perf-env 'PERFORMANCE'
		}
	}
	stage ('Production Environment')
	{
		steps{
			prod-env 'PRODUCTION'
		}
	}
	 stage('Approval')
    {
    steps{
    script {
      
        emailext mimeType: 'text/html',
                 subject: "[Jenkins]${currentBuild.fullDisplayName}",
                 to: "maheshwar.mannur@gmail.com",
                 body: '''<a href="http://13.233.151.1:8080/">click to approve</a>'''

        def userInput = input id: 'userInput',
                              message: 'Let\'s promote?', 
                              submitterParameter: 'submitter',
                              submitter: 'Ritwik',
                              parameters: [
                                [$class: 'TextParameterDefinition', defaultValue: 'sit', description: 'Environment', name: 'env'],
                                [$class: 'TextParameterDefinition', defaultValue: 'k8s', description: 'Target', name: 'target']]

        echo ("Env: "+userInput['env'])
        echo ("Target: "+userInput['target'])
        echo ("submitted by: "+userInput['submitter'])
         
        }
         }
         }
   
		
      }
	}
